<section class="content">
  <div class="content-block">
    <!-- edit-gen-wholsaler-po-order.component.html -->
    <h4 class="mt-4">
      <button class="btn navigate" (click)="navigateBack()">
        <i class="bi bi-arrow-left-circle h4"></i>
      </button>
      <span>
        Update Available Quantities of Wholesaler's Purchase Order 
      </span>
    </h4>
    <div id="purchase-order" class="card p-3 my-2">
      <!-- Header -->
      <div class="header d-flex justify-content-between align-items-center">
        <h1>PURCHASE ORDER</h1>
        <div class="text-end">
          <p><strong>Order Date:</strong> {{ poDate | date:'dd/MM/yyyy' }}</p>
          <p><strong>Order No:</strong> {{ poNumber }}</p>
        </div>
      </div>

      <!-- Wholesaler Info -->
      <div class="border rounded mt-3 p-3 d-flex align-items-start">
        <img [src]="wholesalerLogo" alt="Logo" class="me-3" style="width:80px; height:80px; object-fit:cover;" />
        <div>
          <h5 class="mb-2"><u>Order From:</u></h5>
          <p class="mb-1"><strong>{{ wholesalerCompany }}</strong></p>
          <p class="mb-1">{{ wholesalerEmail }} &bull; {{ wholesalerMobile }}</p>
          <p class="mb-1">GSTIN: {{ wholesalerGSTIN }} &bull; PAN: {{ wholesalerPAN }}</p>
          <p class="mb-1">{{ wholesalerAddress }}</p>
        </div>
      </div>

      <!-- Items Table -->
      <div *ngIf="orderedSet.length" class="mt-3">
        <table class="table table-bordered text-center">
          <thead class="table-light">
            <tr>
              <th>Sr. No.</th>
              <th>Clothing</th>
              <th>Gender</th>
              <th>Colour Name</th>
              <th>Design No.</th>
              <th>Size</th>
              <th>Required Qty</th>
              <th>Input Qty</th>
              <th>Current Stock</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of orderedSet; let i = index"
                [class.partial-row]="item.availableQuantity !== item.totalQuantity">
              <td>{{ i + 1 }}</td>
              <td>{{ item.clothing }}</td>    
              <td>{{ item.gender }}</td>      
              <td>{{ item.colourName }}</td>
              <td>{{ item.designNumber }}</td>
              <td>{{ item.size }}</td>
              <td>{{ item.totalQuantity }}</td>
              <td>
                <input
                  type="number"
                  class="form-control form-control-sm mx-auto"
                  style="width:80px;"
                  [(ngModel)]="item.availableQuantity"
                  (blur)="clampAvailableQuantity(item)"
                  (keydown)="preventInvalidInput($event)"
                  [min]="0"
                  [max]="item.inventoryQuantity"
                  [class.is-invalid]="hasInvalidQuantitiesForItem(item)"
                />
                <div *ngIf="hasInvalidQuantitiesForItem(item)" class="text-danger small mt-1">
                  Invalid Quantity
                </div>
              </td>
              <td [class.low-stock]="item.inventoryQuantity < item.totalQuantity && item.inventoryQuantity > 0"
                  [class.no-stock]="item.inventoryQuantity === 0">
                {{ item.inventoryQuantity }}
              </td>
            </tr>
          </tbody>
        </table>

      </div>

      <!-- Delivery Dates -->
      <div class="mt-4">
        <div class="row mb-3">
          <label class="col-sm-6 col-form-label">Estimated Delivery Date for Available Quantity:</label>
          <div class="col-sm-4">
            <input type="date" class="form-control form-control-sm" [(ngModel)]="expDeliveryDate" [min]="minDate" />
          </div>
        </div>
        <div class="row" *ngIf="hasPartialDelivery()">
          <label class="col-sm-6 col-form-label">Estimated Delivery Date for Make-to-Order Items:</label>
          <div class="col-sm-4">
            <input type="date" class="form-control form-control-sm" [(ngModel)]="partialDeliveryDate" [min]="minDate" />
          </div>
        </div>
      </div>

      <div class="text-center my-3">
        <button class="btn btn-success" [disabled]="!orderedSet.length || hasInvalidQuantities()">
          Update PO
        </button>
      </div>
    </div>
  </div>
</section>