<section class="content">
  <div class="content-block">
    <!-- Page Header -->
    <h4 class="mt-4">
    <button class="btn navigate" (click)="navigateFun()">
        <i class="bi bi-arrow-left-circle h4"></i>
      </button>
      View Purchase Order
    </h4>

    <!-- Purchase Order Container -->
    <div id="purchase-order" class="challan-container card my-2">
      <!-- ✅ Header Section: only included on first page in PDF -->
      <div class="page-header-content" id="purchase-header">
        <!-- Title & Order Info -->
        <div class="header d-flex justify-content-between align-items-center">
          <div class="company-info text-center">
            <h1>PURCHASE ORDER</h1>
          </div>
          <div class="order-info text-right">
            <p><strong>Order Date:</strong> {{ purchaseOrder.poDate }}</p>
            <p><strong>Order No:</strong> {{ purchaseOrder.poNumber }}</p>
          </div>
        </div>

        <!-- Buyer & Seller Details -->
        <div class="buyer-seller-info d-flex justify-content-between">
          <div class="logo">
            <img
              [src]="purchaseOrder.logoUrl"
              alt="Company Logo"
              onerror="this.onerror=null; this.src='assets/images/company_logo.jpg';"
            />
          </div>

          <div class="buyer-info">
            <h5><u>Order By:</u></h5>
            <p><strong>{{ purchaseOrder.buyerName }}</strong></p>
            <p>{{ purchaseOrder.buyerAddress }}</p>
            <p>Phone No.: {{ purchaseOrder.buyerPhone }}</p>
            <p>Email: {{ purchaseOrder.buyerEmail }}</p>
            <p>GSTN: {{ purchaseOrder.buyerGSTIN }}</p>
            <p>PAN: {{ purchaseOrder.buyerPAN }}</p>
          </div>

          <div class="seller-info">
            <h5><u>Order To:</u></h5>
            <p><strong>{{ purchaseOrder.supplierName }}</strong></p>
            <p>{{ purchaseOrder.supplierAddress }}</p>
            <p>Phone No.: {{ purchaseOrder.supplierContact }}</p>
            <p>Email: {{ purchaseOrder.supplierEmail }}</p>
            <p>GSTN: {{ purchaseOrder.supplierGSTIN }}</p>
            <p>PAN: {{ purchaseOrder.supplierPAN }}</p>
          </div>
        </div>

        <!-- ✅ Order Details Title only on first page -->
        <h4 class="text-center mb-3">Order Details</h4>
      </div>

      <!-- Order Details Table (Chunked) -->
      <section class="order-details">
        <ng-container *ngFor="let chunk of tableChunks; let i = index">
          <div [id]="'table-part-' + i" class="table-chunk mb-4">
            <p-table [value]="chunk" [responsive]="true" class="bordered-table">
              <ng-template pTemplate="header">
                <tr>
                  <th>Sr. No.</th>
                  <th>Design No.</th>
                  <th>Colour Name</th>
                  <th>Size</th>
                  <th>Rate</th>
                  <th>Quantity</th>
                  <th>Total Price</th>
                </tr>
              </ng-template>

              <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
                <tr>
                  <td>{{ serialOffset[i] + rowIndex + 1 }}</td>
                  <td>{{ item.designNumber }}</td>
                  <td>{{ item.colourName }}</td>
                  <td>{{ item.size }}</td>
                  <td>₹{{ item.price }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>₹{{ item.quantity * item.price }}</td>
                </tr>
              </ng-template>

              <!-- ✅ Show footer only on last chunk -->
              <ng-template pTemplate="footer" *ngIf="i === tableChunks.length - 1">
                <!-- Subtotal -->
                <tr>
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">Subtotal:</td>
                  <td style="border: 1px solid #dee2e6;">{{ Totalsub | currency: 'INR' }}</td>
                </tr>

                <!-- Discount -->
                <tr>
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">
                    Discount ({{ purchaseOrder.ProductDiscount }}%):
                  </td>
                  <td style="border: 1px solid #dee2e6;">{{ discountAmount | currency: 'INR' }}</td>
                </tr>

                <!-- SGST/CGST -->
                <tr *ngIf="sgst > 0 && cgst > 0">
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">SGST (9%):</td>
                  <td style="border: 1px solid #dee2e6;">{{ sgst | currency: 'INR' }}</td>
                </tr>
                <tr *ngIf="sgst > 0 && cgst > 0">
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">CGST (9%):</td>
                  <td style="border: 1px solid #dee2e6;">{{ cgst | currency: 'INR' }}</td>
                </tr>

                <!-- IGST -->
                <tr *ngIf="igst > 0">
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">IGST (18%):</td>
                  <td style="border: 1px solid #dee2e6;">{{ igst | currency: 'INR' }}</td>
                </tr>

                <!-- Grand Total -->
                <tr>
                  <td colspan="5" style="background-color: #f9f9f9; border: none;"></td>
                  <td style="text-align: right; font-weight: bold; border: 1px solid #dee2e6;">Grand Total:</td>
                  <td style="border: 1px solid #dee2e6;">{{ totalGrandTotal | currency: 'INR' }}</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </ng-container>
      </section>
    </div>

    <!-- Footer Buttons -->
    <div class="row">
      <div class="col-12">
        <div class="text-center my-3">
         
          <button class="btn btn-success ms-auto" (click)="printPO()">Download Purchase Order</button>
        </div>
      </div>
    </div>
  </div>
</section>
