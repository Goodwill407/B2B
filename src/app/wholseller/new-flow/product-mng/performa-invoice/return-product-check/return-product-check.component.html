



<section class="content">
    <div class="content-block">
      <h4 class="mt-4">
        <i class="bi bi-person-vcard-fill h3"></i> Check Received Product
      </h4>
  
      <div id="purchase-order" class="challan-container card my-2">
    
      
        
        <section class="">
          <div *ngIf="mergedProducts && mergedProducts.length > 0">
            <p-table [value]="mergedProducts" class="bordered-table">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Design No</th>
                    <th>Colour</th>
                    <th *ngFor="let size of sizeHeaders">
                      {{ size }} <br/>
                      <span *ngIf="!isSizeAvailable(mergedProducts, size)">N/A</span>
                    </th>
                  </tr>
                </ng-template>
              
                <ng-template pTemplate="body" let-row>
                  <tr *ngFor="let productRow of row.rows">
                    <td>{{ row.designNumber }}</td>
                    <td>{{ productRow.colourName }}</td>
                    <td *ngFor="let size of sizeHeaders">
                      <table>
                        <tr>
                          <th>Received</th>
                          <th>Accepted</th>
                          <th>Defective</th>
                        </tr>
                        <tr>
                          <td>{{ productRow.quantities[size] > 0 ? productRow.quantities[size] : 'N/A' }}</td>
                          <td>
                            <input
                              type="number"
                              [(ngModel)]="productRow.accepted[size]"
                              [readonly]="true"
                              style="width: 50px; text-align: center;"
                            />
                          </td>
                          <td>
                            <input
                              type="number"
                              [(ngModel)]="productRow.defective[size]"
                              (input)="onDefectiveChange(productRow, size)"
                              style="width: 50px; text-align: center;"
                            /> &nbsp;
                            <i 
                              class="fa fa-upload" 
                              aria-hidden="true" 
                              *ngIf="productRow.defective[size] && productRow.defective[size] !== 0"
                              (click)="openFeedbackDialog(productRow, size)"
                            ></i>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </ng-template>
              </p-table>
          </div>
        </section>
        
        
        
      </div>
  
      <div class="row">
        <div class="col-12">
          <div class="text-center my-3">  
            
            <button class="btn btn-success ms-auto" (click)="addpo()">Generate Delivery Challan </button> &nbsp;
            <button class="btn btn-success ms-auto" (click)="printPurchaseOrder()">Download Purchase Order</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  
  <p-dialog [(visible)]="isDialogVisible" [header]="'Feedback'" [modal]="true" [closable]="true" [style]="{width: '50vw'}">
    <div class="p-fluid">
      <div class="p-field">
        <label for="designNumber">Design No</label>
        <input id="designNumber" type="text" [value]="selectedRow?.designNumber" readonly>
      </div>
      <div class="p-field">
        <label for="size">Size</label>
        <input id="size" type="text" [value]="selectedSize" readonly>
      </div>
      <div class="p-field">
        <label for="feedback">Feedback</label>
        <textarea id="feedback" rows="3" [(ngModel)]="feedback"></textarea>
      </div>
    </div>
    <p-footer>
      <button pButton type="button" label="Submit" (click)="submitFeedback()"></button>
    </p-footer>
  </p-dialog>
  
  