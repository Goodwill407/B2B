<section class="content">
    <div class="content-block">
        <h4 class="mt-4">
            <i class="bi bi-person-vcard-fill h3"></i> Check Received Product
        </h4>

        <div id="purchase-order" class="challan-container card my-2">
            <section *ngIf="groupedProducts.length > 0; else noData">
                <div *ngFor="let group of groupedProducts" class="mb-4">
                    <p-table [value]="group.rows" class="styled-table">
                        <ng-template pTemplate="header">
                            <tr>
                                <th rowspan="2">Design No</th>
                                <th rowspan="2">Colour</th>
                                <th *ngFor="let size of sizeHeaders" colspan="2">{{ size }}</th>
                                <th rowspan="2">Confirmation</th>
                            </tr>
                            <tr>
                                <ng-container *ngFor="let size of sizeHeaders">
                                    <th>Ordered</th>
                                    <th>Available</th>
                                </ng-container>
                            </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="body" let-row>
                            <tr>
                                <td>{{ group.designNumber }}</td>
                                <td>
                                    <span *ngIf="row.colourName" class="color-box">
                                        {{ row.colourName }}
                                    </span>
                                    <span *ngIf="!row.colourName"
                                        [ngStyle]="{ 'background-color': row.colour || '#ffffff' }"
                                        class="color-circle">
                                    </span>
                                </td>

                                <!-- Ordered & Available Side-by-Side -->
                                <ng-container *ngFor="let size of sizeHeaders">
                                    <td>{{ row.quantities[size] > 0 ? row.quantities[size] : 'N/A' }}</td>
                                    <td>{{ row.availableQuantities[size] > 0 ? row.availableQuantities[size] : 'N/A' }}</td>
                                </ng-container>

                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-outline-success"
                                            [class.active]="row.confirmation === 'accept'"
                                            (click)="row.confirmation = 'accept'">
                                            Accept
                                        </button>
                                        <button class="btn btn-outline-danger"
                                            [class.active]="row.confirmation === 'reject'"
                                            (click)="row.confirmation = 'reject'">
                                            Reject
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </section>

            <ng-template #noData>
                <p>No data available</p>
            </ng-template>
        </div>
    </div>
</section>
