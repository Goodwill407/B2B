<section class="content">
  <div class="content-block">
    <!-- Page Header -->
    <h4 class="mt-4">
      <button class="btn navigate" (click)="navigateFun()">
        <i class="bi bi-arrow-left-circle h4"></i>
      </button>
      <span>View / Download Purchase Order</span>
    </h4>

    <!-- Button to Download PDF -->
    <div class="d-flex justify-content-end mb-2">
      <button class="btn btn-success" (click)="downloadPO()">Download PDF</button>
    </div>

    <!-- Purchase Order Container -->
    <div id="purchase-order" class="card p-3 my-2">
      <!-- Header Section -->
      <div class="header d-flex justify-content-between align-items-center">
        <h1>PURCHASE ORDER</h1>
        <div class="text-end">
          <p><strong>Order Date:</strong> {{ purchaseOrder.poDate }}</p>
          <p><strong>Order No:</strong> {{ purchaseOrder.orderNumber }}</p>
        </div>
      </div>

      <!-- Buyer and Seller Information -->
      <div class="border rounded mt-3 p-3 d-flex align-items-start">
        <img [src]="purchaseOrder.logoUrl" alt="Company Logo" class="me-3" style="width:80px; height:80px; object-fit:cover;" 
             onerror="this.onerror=null; this.src='assets/images/company_logo.jpg';" />
        <div class="row w-100">
          <div class="col-md-6">
            <h5 class="mb-2"><u>Order By:</u></h5>
            <p class="mb-1"><strong>{{ purchaseOrder.buyerName }}</strong></p>
            <p class="mb-1">{{ purchaseOrder.buyerEmail }} &bull; {{ purchaseOrder.buyerPhone }}</p>
            <p class="mb-1">GSTIN: {{ purchaseOrder.buyerGSTIN }} &bull; PAN: {{ purchaseOrder.buyerPAN }}</p>
            <p class="mb-1">{{ purchaseOrder.buyerAddress }}</p>
          </div>
          <div class="col-md-6">
            <h5 class="mb-2"><u>Order To:</u></h5>
            <p class="mb-1"><strong>{{ purchaseOrder.supplierName }}</strong></p>
            <p class="mb-1">{{ purchaseOrder.supplierEmail }} &bull; {{ purchaseOrder.supplierContact }}</p>
            <p class="mb-1">GSTIN: {{ purchaseOrder.supplierGSTIN }} &bull; PAN: {{ purchaseOrder.supplierPAN }}</p>
            <p class="mb-1">{{ purchaseOrder.supplierAddress }}</p>
          </div>
        </div>
      </div>

      <!-- Order Details Section -->
      <section class="order-details mt-3">
        <h4 class="text-center mb-3">Order Details</h4>

          <p-table [value]="purchaseOrder.products" [responsive]="true"  [paginator]="false" class="bordered-table">
            <ng-template pTemplate="header">
              <tr>
                <th>Sr. No.</th>
                <th>Image</th>
                <th>Clothing</th>
                <th>Gender</th>
                <th>Brand</th>
                <th>Design No.</th>
                <th>HSN Code</th>
                <th>Colour</th>
                <th>Size</th>
                <th>Rate (₹)</th>
                <th>Qty</th>
                <th>Taxable Value (₹)</th>
                <th>GST (%)</th>
                <th *ngIf="isIntraState">CGST (₹)</th>
                <th *ngIf="isIntraState">SGST (₹)</th>
                <th *ngIf="!isIntraState">IGST (₹)</th>
                <th>Total with GST (₹)</th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
              <tr>
                <td>{{ rowIndex + 1 }}</td>
                <td>
                  <img [src]="item.colourImage" alt="{{ item.colourName }}" class="item-image" />
                </td>
                <td>{{ item.clothing }}</td>
                <td>{{ item.gender }}</td>
                <td>{{ item.brandName || 'N/A' }}</td>
                <td>{{ item.designNumber }}</td>
                <td>{{ item.hsnCode }}</td>
                <td>
                  <div class="color-display">
                    <span class="color-swatch" [style.background-color]="item.colour"></span>
                    {{ item.colourName }}
                  </div>
                </td>
                <td>{{ item.size }}</td>
                <td>{{ item.price | indianCurrency }}</td>
                <td>{{ item.quantity }}</td>
                <td class="text-end">{{ getGstAmounts(item).taxable | indianCurrency }}</td>
                <td>{{ item.hsnGst }}%</td>
                <td class="text-end" *ngIf="isIntraState">{{ getGstAmounts(item).cgst | indianCurrency }}</td>
                <td class="text-end" *ngIf="isIntraState">{{ getGstAmounts(item).sgst | indianCurrency }}</td>
                <td class="text-end" *ngIf="!isIntraState">{{ getGstAmounts(item).igst | indianCurrency }}</td>
                <td class="text-end">{{ getGstAmounts(item).totalWithGst | indianCurrency }}</td>
              </tr>
            </ng-template>

            <ng-template pTemplate="footer">
              <!-- Total Row -->
              <tr style="background: #f0f6f9; font-weight: bold;">
                <td colspan="10" style="text-align:right; padding-right: 20px;">Total:</td>
                <td>{{ orderTotals.totalQty }}</td>
                <td class="text-end">{{ orderTotals.totalTaxable | indianCurrency }}</td>
                <td></td>
                <td *ngIf="isIntraState" class="text-end">{{ orderTotals.totalCGST | indianCurrency }}</td>
                <td *ngIf="isIntraState" class="text-end">{{ orderTotals.totalSGST | indianCurrency }}</td>
                <td *ngIf="!isIntraState" class="text-end">{{ orderTotals.totalIGST | indianCurrency }}</td>
                <td class="text-end">{{ orderTotals.totalWithGST | indianCurrency }}</td>
              </tr>
              <!-- Discount on Final Total -->
              <tr>
                <td [attr.colspan]="colspan" style="text-align: right; font-weight: bold;">Discount ({{ purchaseOrder.ProductDiscount }}%):</td>
                <td class="text-end">-{{ discountAmount | indianCurrency }}</td>
              </tr>
              <!-- Grand Total (after discount) -->
              <tr>
                <td [attr.colspan]="colspan" style="text-align: right; font-size: 1.1em; font-weight: bold; color: #002080;">Grand Total (₹):</td>
                <td class="text-end" style="font-size: 1.1em; font-weight: bold; color: #002080;">{{ actualGrandTotal | indianCurrency }}</td>
              </tr>
              <!-- Grand Total in Words -->
              <tr>
                <td [attr.colspan]="colspan+1" style="font-weight: bold; font-size: 1.1em; color: #002080;">
                  Grand Total (in words): {{ actualGrandTotal | amountInWords }}
                </td>
              </tr>
              <tr>
                <td [attr.colspan]="colspan+1" style="font-weight: bold; font-size: 1.0em; color: #006600;">
                  Total GST Paid: ₹ {{totalGSTAmount}} -  {{ totalGSTAmount | amountInWords }}
                </td>
              </tr>
            </ng-template>
          </p-table>
      </section>

      <!-- Transport Details Section - Consistent with GenRetailerOrderPoComponent -->
      <div class="border rounded mt-3 p-3" *ngIf="purchaseOrder.transportDetails">
        <h5 class="mb-2"><u>Transport Details:</u></h5>
        <div class="row">
          <div class="col-md-6">
            <p class="mb-1"><strong>Transport Type:</strong> {{ purchaseOrder.transportDetails.transportType || 'N/A' }}</p>
            <p class="mb-1"><strong>Contact Person:</strong> {{ purchaseOrder.transportDetails.contactPersonName || 'N/A' }}</p>
            <p class="mb-1"><strong>Mode:</strong> {{ purchaseOrder.transportDetails.modeOfTransport || 'N/A' }}</p>
            <p class="mb-1"><strong>GST Number:</strong> {{ purchaseOrder.transportDetails.gstNumber || 'N/A' }}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Company:</strong> {{ purchaseOrder.transportDetails.transporterCompanyName || 'N/A' }}</p>
            <p class="mb-1"><strong>Contact Number:</strong> {{ purchaseOrder.transportDetails.contactNumber || 'N/A' }}</p>
            <p class="mb-1"><strong>Vehicle Number:</strong> {{ purchaseOrder.transportDetails.vehicleNumber || 'N/A' }}</p>
            <p class="mb-1"><strong>Tracking ID:</strong> {{ purchaseOrder.transportDetails.trackingId || 'N/A' }}</p>
          </div>
        </div>
        <div *ngIf="purchaseOrder.transportDetails.remarks" class="mt-2">
          <p class="mb-1"><strong>Remarks:</strong> {{ purchaseOrder.transportDetails.remarks }}</p>
        </div>
        <div *ngIf="purchaseOrder.transportDetails.note" class="mt-2">
          <p class="mb-1"><strong>Note:</strong> {{ purchaseOrder.transportDetails.note }}</p>
        </div>
      </div>

      <!-- Bank Details Card -->
      <div class="border rounded mt-3 p-3" *ngIf="bankDetails">
        <h5 class="mb-2"><u>Bank Details (Manufacturer):</u></h5>
        <div class="row">
          <div class="col-md-6">
            <p class="mb-1"><strong>Account Holder:</strong> {{ bankDetails.accountHolderName || 'N/A' }}</p>
            <p class="mb-1"><strong>Account Number:</strong> {{ bankDetails.accountNumber  || 'N/A'  }}</p>
            <p class="mb-1"><strong>Account Type:</strong> {{ bankDetails.accountType? (bankDetails.accountType | titlecase) : 'N/A' }}</p>
            <p class="mb-1"><strong>Bank Name:</strong> {{ bankDetails.bankName  || 'N/A' }}</p>
            <p class="mb-1"><strong>UPI Id:</strong> {{ bankDetails.upiId || 'N/A'}}</p>
          </div>
          <div class="col-md-6">
            <p class="mb-1"><strong>Branch:</strong> {{ bankDetails.branchName  || 'N/A' }}</p>
            <p class="mb-1"><strong>IFSC Code:</strong> {{ bankDetails.ifscCode  || 'N/A' }}</p>
            <p class="mb-1"><strong>Swift Code:</strong> {{ bankDetails.swiftCode || 'N/A' }}</p>
            <p class="mb-1"><strong>Location:</strong> {{ bankDetails.bankAddress  || 'N/A' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
